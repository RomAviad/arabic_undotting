UNDOT_MAP = {
    1536: (1536, 1536),
    1537: (1537, 1537),
    1538: (1538, 1538),
    1539: (1539, 1539),
    1540: (1540, 1540),
    1541: (1541, 1541),
    1542: (1542, 1542),
    1543: (1543, 1543),
    1544: (1544, 1544),
    1545: (1545, 1545),
    1546: (1546, 1546),
    1547: (1547, 1547),
    1548: (1548, 1548),
    1549: (1549, 1549),
    1550: (1550, 1550),
    1551: (1551, 1551),
    1552: (1552, 1552),
    1553: (1553, 1553),
    1554: (1554, 1554),
    1555: (1555, 1555),
    1556: (1556, 1556),
    1557: (1557, 1557),
    1558: (1558, 1558),
    1559: (1559, 1559),
    1560: (1560, 1560),
    1561: (1561, 1561),
    1562: (1562, 1562),
    1563: (1563, 1563),
    1564: (1564, 1564),
    1565: (1565, 1565),
    1566: (1566, 1566),
    1567: (1567, 1567),
    1568: (1568, 1568),
    1569: (1569, 1569),
    1570: (1570, 1570),
    1571: (1571, 1571),
    1572: (1572, 1572),
    1573: (1573, 1573),
    1574: (1574, 1574),
    1575: (1575, 1575),
    1576: (1646, 1646),
    1577: (1607, 1607),
    1578: (1646, 1646),
    1579: (1646, 1646),
    1580: (1581, 1581),
    1581: (1581, 1581),
    1582: (1581, 1581),
    1583: (1583, 1583),
    1584: (1583, 1583),
    1585: (1585, 1585),
    1586: (1585, 1585),
    1587: (1587, 1587),
    1588: (1587, 1587),
    1589: (1589, 1589),
    1590: (1589, 1589),
    1591: (1591, 1591),
    1592: (1591, 1591),
    1593: (1593, 1593),
    1594: (1593, 1593),
    1595: (1595, 1595),
    1596: (1596, 1596),
    1597: (1597, 1597),
    1598: (1598, 1598),
    1599: (1599, 1599),
    1600: (1600, 1600),
    1601: (1697, 1697),
    1602: (1647, 1647),
    1603: (1603, 1603),
    1604: (1604, 1604),
    1605: (1605, 1605),
    1606: (1646, 1722),
    1607: (1607, 1607),
    1608: (1608, 1608),
    1609: (1609, 1609),
    1610: (1646, 1609),
    1611: (1611, 1611),
    1612: (1612, 1612),
    1613: (1613, 1613),
    1614: (1614, 1614),
    1615: (1615, 1615),
    1616: (1616, 1616),
    1617: (1617, 1617),
    1618: (1618, 1618),
    1619: (1619, 1619),
    1620: (1620, 1620),
    1621: (1621, 1621),
    1622: (1622, 1622),
    1623: (1623, 1623),
    1624: (1624, 1624),
    1625: (1625, 1625),
    1626: (1626, 1626),
    1627: (1627, 1627),
    1628: (1628, 1628),
    1629: (1629, 1629),
    1630: (1630, 1630),
    1631: (1631, 1631),
    1632: (1632, 1632),
    1633: (1633, 1633),
    1634: (1634, 1634),
    1635: (1635, 1635),
    1636: (1636, 1636),
    1637: (1637, 1637),
    1638: (1638, 1638),
    1639: (1639, 1639),
    1640: (1640, 1640),
    1641: (1641, 1641),
    1642: (1642, 1642),
    1643: (1643, 1643),
    1644: (1644, 1644),
    1645: (1645, 1645),
    1646: (1646, 1646),
    1647: (1647, 1647),
    1648: (1648, 1648),
    1649: (1649, 1649),
    1650: (1650, 1650),
    1651: (1651, 1651),
    1652: (1652, 1652),
    1653: (1653, 1653),
    1654: (1654, 1654),
    1655: (1655, 1655),
    1656: (1656, 1656),
    1657: (1657, 1657),
    1658: (1658, 1658),
    1659: (1659, 1659),
    1660: (1660, 1660),
    1661: (1661, 1661),
    1662: (1662, 1662),
    1663: (1663, 1663),
    1664: (1664, 1664),
    1665: (1665, 1665),
    1666: (1666, 1666),
    1667: (1667, 1667),
    1668: (1668, 1668),
    1669: (1669, 1669),
    1670: (1670, 1670),
    1671: (1671, 1671),
    1672: (1672, 1672),
    1673: (1673, 1673),
    1674: (1674, 1674),
    1675: (1675, 1675),
    1676: (1676, 1676),
    1677: (1677, 1677),
    1678: (1678, 1678),
    1679: (1679, 1679),
    1680: (1680, 1680),
    1681: (1681, 1681),
    1682: (1682, 1682),
    1683: (1683, 1683),
    1684: (1684, 1684),
    1685: (1685, 1685),
    1686: (1686, 1686),
    1687: (1687, 1687),
    1688: (1688, 1688),
    1689: (1689, 1689),
    1690: (1690, 1690),
    1691: (1691, 1691),
    1692: (1692, 1692),
    1693: (1693, 1693),
    1694: (1694, 1694),
    1695: (1695, 1695),
    1696: (1696, 1696),
    1697: (1697, 1697),
    1698: (1698, 1698),
    1699: (1699, 1699),
    1700: (1700, 1700),
    1701: (1701, 1701),
    1702: (1702, 1702),
    1703: (1703, 1703),
    1704: (1704, 1704),
    1705: (1705, 1705),
    1706: (1706, 1706),
    1707: (1707, 1707),
    1708: (1708, 1708),
    1709: (1709, 1709),
    1710: (1710, 1710),
    1711: (1711, 1711),
    1712: (1712, 1712),
    1713: (1713, 1713),
    1714: (1714, 1714),
    1715: (1715, 1715),
    1716: (1716, 1716),
    1717: (1717, 1717),
    1718: (1718, 1718),
    1719: (1719, 1719),
    1720: (1720, 1720),
    1721: (1721, 1721),
    1722: (1722, 1722),
    1723: (1723, 1723),
    1724: (1724, 1724),
    1725: (1725, 1725),
    1726: (1726, 1726),
    1727: (1727, 1727),
    1728: (1728, 1728),
    1729: (1729, 1729),
    1730: (1730, 1730),
    1731: (1731, 1731),
    1732: (1732, 1732),
    1733: (1733, 1733),
    1734: (1734, 1734),
    1735: (1735, 1735),
    1736: (1736, 1736),
    1737: (1737, 1737),
    1738: (1738, 1738),
    1739: (1739, 1739),
    1740: (1740, 1740),
    1741: (1741, 1741),
    1742: (1742, 1742),
    1743: (1743, 1743),
    1744: (1744, 1744),
    1745: (1745, 1745),
    1746: (1746, 1746),
    1747: (1747, 1747),
    1748: (1748, 1748),
    1749: (1749, 1749),
    1750: (1750, 1750),
    1751: (1751, 1751),
    1752: (1752, 1752),
    1753: (1753, 1753),
    1754: (1754, 1754),
    1755: (1755, 1755),
    1756: (1756, 1756),
    1757: (1757, 1757),
    1758: (1758, 1758),
    1759: (1759, 1759),
    1760: (1760, 1760),
    1761: (1761, 1761),
    1762: (1762, 1762),
    1763: (1763, 1763),
    1764: (1764, 1764),
    1765: (1765, 1765),
    1766: (1766, 1766),
    1767: (1767, 1767),
    1768: (1768, 1768),
    1769: (1769, 1769),
    1770: (1770, 1770),
    1771: (1771, 1771),
    1772: (1772, 1772),
    1773: (1773, 1773),
    1774: (1774, 1774),
    1775: (1775, 1775),
    1776: (1776, 1776),
    1777: (1777, 1777),
    1778: (1778, 1778),
    1779: (1779, 1779),
    1780: (1780, 1780),
    1781: (1781, 1781),
    1782: (1782, 1782),
    1783: (1783, 1783),
    1784: (1784, 1784),
    1785: (1785, 1785),
    1786: (1786, 1786),
    1787: (1787, 1787),
    1788: (1788, 1788),
    1789: (1789, 1789),
    1790: (1790, 1790),
    1791: (1791, 1791)
}


def undot(text):
    result = []
    last_index = len(text) - 1
    for idx, c in enumerate(text):
        ord_c = ord(c)
        ch_map = UNDOT_MAP.get(ord_c, [ord_c, ord_c])
        if idx == last_index or text[idx+1].isspace():
            undotted = ch_map[1]
        else:
            undotted = ch_map[0]
        result.append(chr(undotted))

    return "".join(result)


def test_undotting():
    no_diac = "صف خلق خود كمثل الشمس اذ بزغت — يحظى الضجيع بها نجلاء معطار"
    gt = "صڡ حلٯ حود كمٮل السمس اد ٮرعٮ — ٮحطى الصحٮع ٮها ٮحلاء معطار"
    no_dots = undot(no_diac)
    if gt != no_dots:
        for idx, c in enumerate(no_dots):
            if c != gt[idx]:
                print("**\n", ord(c),
                      c, f"\n{no_diac[idx]} {ord(no_diac[idx])}", "\n", ord(gt[idx]),
                      gt[idx],
                      f"\n{idx}**")
    assert gt == no_dots, f"\n{no_dots}\n{gt}"


# if __name__ == "__main__":
#     test_undotting()

